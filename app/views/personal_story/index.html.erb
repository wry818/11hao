<div class="container" style="color:#333; background-color:#ededed; font-family:'Microsoft YaHei', '微软雅黑', arial, sans-serif;">
	<div class="row" style="text-align:center; position:relative">
	  <img src="/images/personals/p_11.jpg" style="width:100%;">
		
		<div style="position:absolute; left:10px; bottom:5px;">
			<span style="color:white; font-size:18px; letter-spacing:1px;"><%= @campaign.title %></span>
		</div>
	</div>
	
  <div class="row" style="background-color:white;">
    <div class="col-xs-12">
      <div style="padding:10px 0px 60px 0px;">
        <% if !@campaign.goal.nil? %>
            <table style="width:100%; margin:0px auto;">
              <tr>
                <td style="width:90%;">
                  <div class="progress" style="height:10px; margin:0px 0px;">
                    <div class="progress-bar progress-bar-warning" style="height:100%; width:<%= @campaign.progress_percent > 100 ? 100 : @campaign.progress_percent  %>%;"></div>
                  </div>
                </td>
                <td style="width:10%; text-align:center;">
                  <span style="color:#f0ad4e;">&nbsp;&nbsp;<%= @campaign.progress_percent %>%</span>
                </td>
              </tr>
            </table>
        <% end %>
        <table style="color:#888; width:100%; margin:5px auto 0px auto;">
          <tr>
            <td style="border-right:1px solid #ddd; width:50%;">
              <span>目标&nbsp;&nbsp;<%= short_price @campaign.goal.nil? ? 0 : @campaign.goal %>&nbsp;元</span>
              <br/>
              已筹&nbsp;&nbsp;<span style="color:#f0ad4e;"><strong><%= short_price @campaign.raised %>&nbsp;元</strong></span>
            </td>
            <td style="text-align:center; width:50%;">
              <span>捐款人数</span>
              <br/>
              <span style="color:#f0ad4e;"><strong><%= @campaign.supporters %>&nbsp;</strong></span>人
            </td>
          </tr>
        </table>

        <hr/>

        <p>一个是只有“头”和“胳膊”可以活动的高位截瘫的母亲，一个是22个月大的嗷嗷待哺的孩子，他们正倔强的活着……</p>

        <p><img src="/images/personals/p_20.jpg" class="img-responsive img-rounded" style="margin:0px auto;"></p>

        <h3><strong>儿时的梦想</strong></h3>

        <p>我叫孙兰兰，女，1986年7月出生，现年29岁，住在湖北一个贫困的小山村，去趟集市要走十几里山路。母亲十五年前病逝，家里弟兄姊妹五个，全靠爸爸一人抚养。从小我就有个梦想，长大了，要出去看看外面的世界……</p>

        <p><img src="/images/personals/p_01.jpg" class="img-responsive img-rounded" style="margin:0px auto;"></p>

        <p>我拼命读书，功夫不负有心人，终于在2008年6月拿到“中南财经政法大学”毕业证书和学位证书。随后在“上海达丰电脑”工作，我以为，美好的人生从此拉开序幕……</p>
				
				<p><img src="/images/personals/p_02.jpg" class="img-responsive img-rounded" style="margin:0px auto;"></p>

        <h3><strong>病魔无情</strong></h3>

        <p>谁知天有不测风云，人有旦夕祸福，自2012年2月中旬开始，我持续头痛发晕，四肢无力，辗转三四家医院，一直没有查到病因，吃了无数药，输了各种液，我的双腿却渐渐的再也抬不起来……同年3-6月，先后在“上海复旦大学附属中山医院”、“上海市公共卫生临床中心”和“中国人民解放军第三0九医院（北京）”被诊断为“结核性脑脊膜脊髓炎、截瘫、白细胞减少、泌尿系感染、电解质紊乱”等病症，并造成高位截瘫、大小便失禁后遗症，只能常年插导尿管……</p>

        <p><img src="/images/personals/p_03.jpg" class="img-responsive img-rounded" style="margin:0px auto;"></p>

        <p><img src="/images/personals/p_04.jpg" class="img-responsive img-rounded" style="margin:0px auto;"></p>

        <p>从北京309出院回家后，我又出现“高烧”、“癫痫”等症状，先后又在南阳，武汉等地治疗，一直持续到2013年12月，前后花费约50万余元，病情始终无好转迹象。从此，我的视力所及仅限卧室，出行只能轮椅为伴。当别人说走就走的时候，我却连喝口水都需要帮忙，过着可怜的寄生虫似的生活。不能决定吃什么，穿什么，没法洗澡，甚至连翻身都不能；没有爱好的权利，没有人格尊严，大多数时候只能忍气吞声，逆来顺受，别人享受天伦之乐的时候，我却觉得孤独难耐，羡慕的心疼，此生了无盼望，甚至想寻死……</p>

        <p><img src="/images/personals/p_05.jpg" class="img-responsive img-rounded" style="margin:0px auto;"></p>

        <p><img src="/images/personals/p_06.jpg" class="img-responsive img-rounded" style="margin:0px auto;"></p>

        <h3><strong>万般无奈，接受现实</strong></h3>

        <p>对于我，活着比死更需要勇气！我绝食过，绝望过，成为所有人的拖累，是我一千个一万个不愿意。曾经，我有很多的梦想，但是此刻，我却连走路都不能！可是看到家人的关爱，操劳，我连死的勇气都没有，只能在这个世界上苟延残喘……
          2013年8月家人在县残联帮我办理了一级残疾证，一级！！！</p>

        <p><img src="/images/personals/p_07.jpg" class="img-responsive img-rounded" style="margin:0px auto;"></p>

        <p>家人和老公都很爱我，让我有勇气活了下来！</p>

        <p>下图为2013年7月，轮椅上的生日……</p>

        <p><img src="/images/personals/p_08.jpg" class="img-responsive img-rounded" style="margin:0px auto;"></p>

        <p>我每天只能趴着吃饭……</p>

        <p><img src="/images/personals/p_09.jpg" class="img-responsive img-rounded" style="margin:0px auto;"></p>

        <h3><strong>爱子降生，甜蜜负担</strong></h3>

        <p>感谢上天眷顾，虽然高位截瘫，但是上帝赐给我一个健康的孩子，2014.2.21，我的儿子“依凡”降生，从此，他就是我此生的盼望……</p>

        <p><img src="/images/personals/p_10.jpg" class="img-responsive img-rounded" style="margin:0px auto;"></p>

        <p>由于我胸口以下完全没有知觉，剖腹产，十几厘米的口子，一滴麻药都没打，宝宝平安出生，真是奇迹！</p>

        <p><img src="/images/personals/p_11.jpg" class="img-responsive img-rounded" style="margin:0px auto;"></p>

        <p>但是难题来了，我自己坐不起来，甚至连翻身都不能，只能老公和姐姐扶着喂奶，有点吃力，对不起宝宝，要跟我们一起受苦了……</p>

        <p><img src="/images/personals/p_12.jpg" class="img-responsive img-rounded" style="margin:0px auto;"></p>

        <p>虽然历经种种难处，怀孕时无法锻炼，营养不足，药物反应，宝宝生下来时大脑缺氧，心脏有个缺口没有长好，经过治疗，宝宝还是健康的长大了。感谢姐姐、婆婆和老公，经历无数个不眠之夜，把我的儿子抚养长大，而我，却只能躺着，在他哭的时候，陪着揪心……</p>

        <p><img src="/images/personals/p_13.jpg" class="img-responsive img-rounded" style="margin:0px auto;"></p>

        <p>夏天，老公在院子里给宝宝洗澡，我看着他们，觉得心里甜甜的……</p>

        <p><img src="/images/personals/p_14.jpg" class="img-responsive img-rounded" style="margin:0px auto;"></p>

        <p>宝宝很听话，自己吃饭的时候不忘去看看爸爸饭做好了没有？妈妈还没有吃饭呢。我的老公，就这样日复一日，年复一年，为我和儿子做饭，很辛苦……</p>

        <p><img src="/images/personals/p_15.jpg" class="img-responsive img-rounded" style="margin:0px auto;"></p>

        <p>终于，儿子会跑了，作为母亲，我很欣慰！图为下雨了，他向我躺着的床跑来。</p>

        <p><img src="/images/personals/p_17.jpg" class="img-responsive img-rounded" style="margin:0px auto;"></p>

        <h3><strong>火灾无情，雪上加霜</strong></h3>

        <p>从2012.2生病至今，已经近四年，高昂的医药费早已使家里家徒四壁，外债累累。儿子的降生，更是一颗甜蜜炸弹，高兴的同时，还要预备高额抚养费。由于我长期用药，除了刚出生几天，后来都是奶粉喂养，费用高昂。而我还需要定期检查，消炎，长期的卧床护理产品，衣食起居等费用，使老公背负着巨大的经济和思想压力，一方面要照顾我，每天为我擦洗，定期换导尿管，甚至隔两天需要为我抠大便。另一方面，还要照顾不满两岁的儿子，喂奶粉，换尿布，洗衣做饭等。由于我和我不到2岁的儿子生活完全不能自理，我的丈夫要常年在身旁照顾，家里无任何经济来源。2015年12月，祸不单行，因高温炉火外泄，造成家里失火，家里的物品基本上都被烧了。我的丈夫因一时接受不了这个打击，离家出走。</p>

        <p>目前，我能想到的办法都用过了。为了我不到2岁的儿子，我也必须活下去。走投无路之下，我请求社会有心人士能伸出援手，帮帮我们！</p>

        <p><img src="/images/personals/p_18.jpg" class="img-responsive img-rounded" style="margin:0px auto;"></p>

        <div style="margin-top:10px;">
          <p><strong>联系方式</strong></p>

          <p>Email: 277275431@qq.com</p>

          <p><strong>捐赠账号</strong></p>

          <p>支付宝: 277275431@qq.com</p>

          <p>农行: 6228483271727431516 孙兰兰</p>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="navbar-fixed-bottom" style="padding:5px 0px; text-align:center;">
  <button type="button" data-toggle="modal" data-target="#personal-modal" class="btn btn-primary" style="border-radius:4px; box-shadow: 1px 1px 1px #888;">
    <span class="glyphicon glyphicon-heart-empty"></span>&nbsp;&nbsp;<span class="text" style="font-size:16px; letter-spacing:1px;">我要捐款</span>
  </button>
</div>

<!-- 模态框（Modal） -->
<div class="modal fade" id="personal-modal" tabindex="-1" role="dialog" aria-labelledby="personal-modal" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <%= form_tag(personal_story_checkout_confirmation_path, method: "post", id: "payment_form") %>
      <div class="modal-header" style="padding: 10px;">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h5 class="modal-title">
          请输入捐款金额
        </h5>
      </div>
      <div class="modal-body">
        <div id="personal_modalbody">
          <table style="width:100%;">
            <tr>
              <td style="padding:0px 5px; text-align:center; width:33%;">
                <a href="javascript:void(0);" data-value="20" class="list-group-item">20<span>元</span></a>
              </td>
              <td style="padding:0px 5px; text-align:center; width:33%;">
                <a href="javascript:void(0);" data-value="50" class="list-group-item">50<span>元</span></a>
              </td>
              <td style="padding:0px 5px; text-align:center; width:34%;">
                <a href="javascript:void(0);" data-value="100" class="list-group-item">100<span>元</span></a>
              </td>
            </tr>
          </table>
          <div style="margin-top:15px; padding:0px 5px;">
            <div class="input-group">
              <span class="input-group-addon">金额</span>
              <input class="form-control" id="direct_donation_input" placeholder="输入捐款金额" type="text" value="">
              <span class="input-group-addon">元</span>
            </div>
            <div style="display: none;"> <%= text_field_tag :direct_donation, "", class: 'form-control', placeholder: '输入捐款金额' %></div>

          </div>
        </div>
      </div>
      <div class="modal-footer" style="text-align: center;">
        <input type="hidden" id="order_id" name="campagin_id" value="<%= @campaign.id %>"/>

        <button id="payment-form-submit" class="btn btn-primary btn-sm btn-block" type="submit" style="border-radius:4px; box-shadow: 1px 1px 1px #888;width: 60%; margin: 0px auto;">
          <span class="text" data-text="微信捐赠" style="letter-spacing:1px;">立即捐款</span>
          <span class="loader" style="display:none"></span>
        </button>

        <%= link_to "立即捐款", "javascript:void(0)", :id => 'wechat', :class => 'btn btn-primary btn-sm btn-block', style: "letter-spacing:1px; border-radius:4px; box-shadow: 1px 1px 1px #888;width: 60%;margin: 0px auto;" %>
      </div>
			
			<%= hidden_field_tag :fullname, @nickname %>
			<%= hidden_field_tag :avatar_url, @avatar_url %>
      </form>
    </div><!-- /.modal-content -->
  </div><!-- /.modal -->
</div>

<div id="weixin_onbridgeread" style="width: 0px;height: 0px;overflow: hidden;"></div>

<script language="javascript" type="text/javascript">
  $(function () {
    document.title = "为幼儿瘫母撑起希望";


    if (<%= @is_wechat_browser %> == false
    )
    {
      $("#payment-form-submit").show();
      $('#wechat').hide();
    }
    else
    {
      $("#payment-form-submit").hide();
      $('#wechat').show();
    }

    if (typeof WeixinJSBridge == "undefined") {
      if (document.addEventListener) {
        document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);
      } else if (document.attachEvent) {
        document.attachEvent('WeixinJSBridgeReady', onBridgeReady);
        document.attachEvent('onWeixinJSBridgeReady', onBridgeReady);
      }
    } else {
      onBridgeReady();
    }

    function onBridgeReady() {
      if ("<%= @weixin_init_success %>" == "true") {
        $('#wechat').click(function () {
          var url = "<%=personal_story_checkout_confirmation__weixin_path%>";
          var direct_donation = $("#direct_donation_input").val();

          if (direct_donation.length <= 0) {
            alert("请输入捐款金额。");
            return;
          }

          $('#wechat').prop('disabled', true);

          $.post(url, {direct_donation: direct_donation}).success(function (data, textStatus, jqXHR) {
            $("#weixin_onbridgeread").html(data);
            weixin_load();
          }).error(function () {
            alert("请求已经结束但是可能发生了错误！");
          }).complete(function () {
            $('#wechat').prop('disabled', false);
          });
        });
      } else {
        alert("系统忙，请刷新页面再试。");
      }
    }
  });

  //限定输入框为数字
  $(function () {
    $.fn.numeral = function (bl) {//限制金额输入、兼容浏览器、屏蔽粘贴拖拽等
      $(this).keypress(function (e) {
        var keyCode = e.keyCode ? e.keyCode : e.which;
        if (bl) {//浮点数
          if ((this.value.length == 0 || this.value.indexOf(".") != -1) && keyCode == 46) return false;
          return keyCode >= 48 && keyCode <= 57 || keyCode == 46 || keyCode == 8;
        } else {//整数
          return keyCode >= 48 && keyCode <= 57 || keyCode == 8;
        }
      });
      $(this).bind("copy cut paste", function (e) { // 通过空格连续添加复制、剪切、粘贴事件
        if (window.clipboardData)//clipboardData.setData('text', clipboardData.getData('text').replace(/\D/g, ''));
          return !clipboardData.getData('text').match(/\D/);
        else
          event.preventDefault();
      });
      $(this).bind("dragenter", function () {
        return false;
      });
      $(this).css("ime-mode", "disabled");
      $(this).bind("focus", function () {
        if (this.value.lastIndexOf(".") == (this.value.length - 1)) {
          this.value = this.value.substr(0, this.value.length - 1);
        } else if (isNaN(this.value)) {
          this.value = "";
        }
      });
    }
    //调用文本框的id
    $("#direct_donation_input").numeral(true);
  });

  $(function () {

    $("#payment-form-submit").bind("click", function () {
      if($("#direct_donation_input").val().length>0)
      {
        $("#direct_donation").val($("#direct_donation_input").val());
      }
    });
    $("#direct_donation_input").bind("blur", function () {
//      alert(1);
      if ($(this).val().length > 0) {
        $("#personal_modalbody a").each(function () {
          $(this).css('border', "1px solid #dddddd");
        });
      }
    });
    $("#personal_modalbody a").bind('click', function () {
      $("#direct_donation_input").val("");
      $("#direct_donation").val($(this).data("value"));
      $("#personal_modalbody a").each(function () {
        $(this).css('border', "1px solid #dddddd");
      });

      $(this).css('border', "solid 2px red");
    });
  });
</script>

<% if @sign_package %>
    <script>
      window.shareData = {
        appid: "<%= ENV['WEIXIN_APPID'] %>",
        link: "<%= request.original_url %>",
        img_url: "<%= request.protocol + request.host_with_port + '/images/personals/p_20.jpg' %>",
        img_width: "415",
        img_height: "399",
        desc: "一个是只有'头'和'胳膊'可以活动的高位截瘫的母亲, 一个是22个月大的嗷嗷待哺的孩子, 他们正倔强的活着...",
        title: "为幼儿瘫母撑起希望"
      };

      wx.config({
        debug: false,
        appId: "<%= @sign_package['appId'] %>",
        timestamp: "<%= @sign_package['timestamp'] %>",
        nonceStr: "<%= @sign_package['nonceStr'] %>",
        signature: "<%= @sign_package['signature'] %>",
        jsApiList: [
          'onMenuShareTimeline',
          'onMenuShareAppMessage',
          'onMenuShareQQ',
          'onMenuShareWeibo'
        ] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
      });

      wx.ready(function () {

        var title = shareData.title;
        var desc = shareData.desc;
        var link = shareData.link;
        var imgUrl = shareData.img_url

        wx.onMenuShareTimeline({
          title: title, // 分享标题
          desc: desc, // 分享描述
          link: link, // 分享链接
          imgUrl: imgUrl, // 分享图标
          success: function () {
            // 用户确认分享后执行的回调函数
          },
          cancel: function () {
            // 用户取消分享后执行的回调函数
          }
        });

        wx.onMenuShareAppMessage({
          title: title, // 分享标题
          desc: desc, // 分享描述
          link: link, // 分享链接
          imgUrl: imgUrl, // 分享图标
          // type: 'link', // 分享类型,music、video或link，不填默认为link
// 	    dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
          success: function () {
            // alert("分享成功！");
            // 用户确认分享后执行的回调函数
          },
          cancel: function () {
            // 用户取消分享后执行的回调函数
          }
        });

        wx.onMenuShareQQ({
          title: title, // 分享标题
          desc: desc, // 分享描述
          link: link, // 分享链接
          imgUrl: imgUrl, // 分享图标
          success: function () {
            // 用户确认分享后执行的回调函数
          },
          cancel: function () {
            // 用户取消分享后执行的回调函数
          }
        });

        wx.onMenuShareWeibo({
          title: title, // 分享标题
          desc: desc, // 分享描述
          link: link, // 分享链接
          imgUrl: imgUrl, // 分享图标
          success: function () {
            // 用户确认分享后执行的回调函数
          },
          cancel: function () {
            // 用户取消分享后执行的回调函数
          }
        });

      });

      wx.error(function (res) {

        // config信息验证失败会执行error函数，如签名过期导致验证失败，具体错误信息可以打开config的debug模式查看，也可以在返回的res参数中查看，对于SPA可以在这里更新签名。
        alert(res.errMsg);
      });
    </script>
<% end %>