<script type="text/javascript">

        $(document).ready(function () {

            var addrSign = "<%= @addrSign %>";

            if (addrSign != "") {
				
                window.setTimeout(function () {

                    WeixinJSBridge.invoke('editAddress', {
                        "appId": "<%= @app_id %>",
                        "scope": "jsapi_address",
                        "signType": "sha1",
                        "addrSign": "<%= @addrSign %>",
                        "timeStamp": "<%= @timestamp %>",
                        "nonceStr": "<%= @nonceStr %>"
						
                    }, function (res) {
						
						if (res && res.userName) {
							SaveAddress(res);
						
						}
						
						else {
							
							window.history.go(-1);
						
						}
												

                    });
                }, 500);

            }

        });
				
		function SaveAddress(res) {
			
			window.Raisy.SetCurrentShippingAddress(res.userName, res.addressDetailInfo, res.proviceFirstStageName, res.addressCitySecondStageName, res.addressCountiesThirdStageName, res.telNumber);
			
			window.location.href = "/checkout/" + "<%= @campaign_id %>";
		
		}
				
</script>