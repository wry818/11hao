/*
 * jQuery Guillotine Plugin v1.2.2
 * http://matiasgagliano.github.com/guillotine/
 *
 * Copyright 2014, MatÃ­as Gagliano.
 * Dual licensed under the MIT or GPLv3 licenses.
 * http://opensource.org/licenses/MIT
 * http://opensource.org/licenses/GPL-3.0
 *
 */

(function(){"use strict";var t,i,e,h,n,s,o,r,a,u,l,d,c,p=[].indexOf||function(t){for(var i=0,e=this.length;e>i;i++)if(i in this&&this[i]===t)return i;return-1},g=function(t,i){return function(){return t.apply(i,arguments)}};t=jQuery,u="guillotine",l="guillotine",n={start:"touchstart."+l+" mousedown."+l+" MSPointerDown."+l,move:"touchmove."+l+"  mousemove."+l+" MSPointerMove."+l,stop:"touchend."+l+"   mouseup."+l+"   MSPointerUp."+l},h={width:400,height:300,zoomStep:.1,init:null,eventOnChange:null,onChange:null},a=function(t){return t.type.search("touch")>-1},r=function(){return p.call(window,"MSPointerEvent")>=0},d=function(t){return(d=r()||!a(t)?function(t){return null!=t.which&&1===t.which}:function(){var i,e;return 1===(null!=(i=t.originalEvent)&&null!=(e=i.touches)?e.length:void 0)})(t)},s=function(t){return(s=r()||!a(t)?function(t){return{x:t.pageX,y:t.pageY}}:function(t){return t=t.originalEvent.touches[0],{x:t.pageX,y:t.pageY}})(t)},e=function(){var t,i,h,n,s,o,r,a,u,l;for(t=!1,n="webkit,Moz,O,ms,Khtml".split(","),r={transform:"transform"},u=0,l=n.length;l>u;u++)h=n[u],r[h+"Transform"]="-"+h.toLowerCase()+"-transform";i=document.createElement("img"),document.body.insertBefore(i,null);for(o in r)if(s=r[o],void 0!==i.style[o]&&(i.style[o]="rotate(90deg)",a=window.getComputedStyle(i).getPropertyValue(s),null!=a&&a.length&&"none"!==a)){t=!0;break}return document.body.removeChild(i),(e=t?function(){return!0}:function(){return!1})()},o=function(i){return t(i).css({"-webkit-perspective":1e3,perspective:1e3,"-webkit-backface-visibility":"hidden","backface-visibility":"hidden"})},i=function(){function i(i,e){this._drag=g(this._drag,this),this._unbind=g(this._unbind,this),this._start=g(this._start,this);var s;this.op=t.extend(!0,{},h,e,t(i).data(u)),this.enabled=!0,this.zoomInFactor=1+this.op.zoomStep,this.zoomOutFactor=1/this.zoomInFactor,s=[0,0,0,0,0],this.width=s[0],this.height=s[1],this.left=s[2],this.top=s[3],this.angle=s[4],this.data={scale:1,angle:0,x:0,y:0,w:this.op.width,h:this.op.height},this._wrap(i),null!=this.op.init&&this._init(),(this.width<1||this.height<1)&&this._fit()&&this._center(),o(this.$el),this.$el.on(n.start,this._start)}return i.prototype._wrap=function(i){var e,h,n,s,o,r,a,u,l,d;return h=t(i),"IMG"===h.prop("tagName")?(o=document.createElement("img"),o.src=h.attr("src"),u=[o.width,o.height],a=u[0],s=u[1]):(l=[h.width(),h.height()],a=l[0],s=l[1]),d=[a/this.op.width,s/this.op.height],this.width=d[0],this.height=d[1],e=t("<div>").addClass("guillotine-canvas"),e.css({width:100*this.width+"%",height:100*this.height+"%",top:0,left:0}),e=h.wrap(e).parent(),r=this.op.height/this.op.width*100+"%",n=t("<div>").addClass("guillotine-window"),n.css({width:"100%",height:"auto","padding-top":r}),n=e.wrap(n).parent(),this.$el=h,this.el=h[0],this.$canvas=e,this.canvas=e[0],this.$gllt=n,this.gllt=n[0],this.$document=t(i.ownerDocument)},i.prototype._unwrap=function(){return this.$el.removeAttr("style"),this.$el.insertBefore(this.gllt),this.$gllt.remove()},i.prototype._init=function(){var t,i,e;return i=this.op.init,(t=parseInt(i.angle))&&this._rotate(t),(e=parseFloat(i.scale))&&this._zoom(e),this._offset(parseInt(i.x)/this.op.width,parseInt(i.y)/this.op.height)},i.prototype._start=function(t){return this.enabled&&d(t)?(t.preventDefault(),t.stopImmediatePropagation(),this.p=s(t),this._bind()):void 0},i.prototype._bind=function(){return this.$document.on(n.move,this._drag),this.$document.on(n.stop,this._unbind)},i.prototype._unbind=function(t){return this.$document.off(n.move,this._drag),this.$document.off(n.stop,this._unbind),null!=t?this._trigger("drag"):void 0},i.prototype._trigger=function(t){return null!=this.op.eventOnChange&&this.$el.trigger(this.op.eventOnChange,[this.data,t]),"function"==typeof this.op.onChange?this.op.onChange.call(this.el,this.data,t):void 0},i.prototype._drag=function(t){var i,e,h,n,o;return t.preventDefault(),t.stopImmediatePropagation(),n=s(t),i=n.x-this.p.x,e=n.y-this.p.y,this.p=n,h=0===i?null:this.left-i/this.gllt.clientWidth,o=0===e?null:this.top-e/this.gllt.clientHeight,this._offset(h,o)},i.prototype._offset=function(t,i){return(t||0===t)&&(0>t&&(t=0),t>this.width-1&&(t=this.width-1),this.canvas.style.left=(100*-t).toFixed(2)+"%",this.left=t,this.data.x=Math.round(t*this.op.width)),i||0===i?(0>i&&(i=0),i>this.height-1&&(i=this.height-1),this.canvas.style.top=(100*-i).toFixed(2)+"%",this.top=i,this.data.y=Math.round(i*this.op.height)):void 0},i.prototype._zoom=function(t){var i,e,h,n,s;if(!(0>=t||1===t))return s=[this.width,this.height],n=s[0],i=s[1],n*t>1&&i*t>1?(this.width*=t,this.height*=t,this.canvas.style.width=(100*this.width).toFixed(2)+"%",this.canvas.style.height=(100*this.height).toFixed(2)+"%",this.data.scale*=t):(this._fit(),t=this.width/n),e=(this.left+.5)*t-.5,h=(this.top+.5)*t-.5,this._offset(e,h)},i.prototype._fit=function(){var t,i;return t=this.width,i=this.height/this.width,i>1?(this.width=1,this.height=i):(this.width=1/i,this.height=1),this.canvas.style.width=(100*this.width).toFixed(2)+"%",this.canvas.style.height=(100*this.height).toFixed(2)+"%",this.data.scale*=this.width/t},i.prototype._center=function(){return this._offset((this.width-1)/2,(this.height-1)/2)},i.prototype._rotate=function(t){var i,h,n,s,o,r,a;if(e()&&0!==t&&t%90===0)return this.angle=(this.angle+t)%360,this.angle<0&&(this.angle=360+this.angle),t%180!==0&&(h=this.op.height/this.op.width,o=[this.height*h,this.width/h],this.width=o[0],this.height=o[1],this.width>=1&&this.height>=1?(this.canvas.style.width=100*this.width+"%",this.canvas.style.height=100*this.height+"%"):this._fit()),r=[1,1],s=r[0],n=r[1],this.angle%180!==0&&(i=this.height/this.width*h,a=[i,1/i],s=a[0],n=a[1]),this.el.style.width=100*s+"%",this.el.style.height=100*n+"%",this.el.style.left=(1-s)/2*100+"%",this.el.style.top=(1-n)/2*100+"%",this.$el.css({transform:"rotate("+this.angle+"deg)"}),this._center(),this.data.angle=this.angle},i.prototype.rotateLeft=function(){return this.enabled&&(this._rotate(-90),this._trigger("rotateLeft"))},i.prototype.rotateRight=function(){return this.enabled&&(this._rotate(90),this._trigger("rotateRight"))},i.prototype.center=function(){return this.enabled&&(this._center(),this._trigger("center"))},i.prototype.fit=function(){return this.enabled&&(this._fit(),this._center(),this._trigger("fit"))},i.prototype.zoomIn=function(){return this.enabled&&(this._zoom(this.zoomInFactor),this._trigger("zoomIn"))},i.prototype.zoomOut=function(){return this.enabled&&(this._zoom(this.zoomOutFactor),this._trigger("zoomOut"))},i.prototype.getData=function(){return this.data},i.prototype.enable=function(){return this.enabled=!0},i.prototype.disable=function(){return this.enabled=!1},i.prototype.remove=function(){return this._unbind(),this._unwrap(),this.disable(),this.$el.off(n.start,this._start),this.$el.removeData(u+"Instance")},i}(),c=["rotateLeft","rotateRight","center","fit","zoomIn","zoomOut","instance","getData","enable","disable","remove"],t.fn[u]=function(e){return"string"!=typeof e?this.each(function(){var h;return t.data(this,u+"Instance")?void 0:(h=new i(this,e),t.data(this,u+"Instance",h))}):p.call(c,e)>=0?"instance"===e?t.data(this[0],u+"Instance"):"getData"===e?t.data(this[0],u+"Instance")[e]():this.each(function(){var i;return i=t.data(this,u+"Instance"),i?i[e]():void 0}):void 0}}).call(this);
